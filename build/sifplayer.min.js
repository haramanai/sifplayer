/*
 Copyright (c) 2012 haramanai.
 sifPlayer
 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
*/
this.sifPlayer=this.sifPlayer||{};
(function(){sifPlayer._getData=function(f){function e(b,d){a[b]?(a[b].constructor!=Array&&(a[b]=[a[b]]),a[b][a[b].length]=d):a[b]=d}var a={},b,d,g;for(b=0;d=f.attributes[b];b++)e("_"+d.name,sifPlayer._toSifValue(d.value));for(b=0;d=f.childNodes[b];b++)if(1==d.nodeType)if(g=d.nodeName,1==d.childNodes.length&&3==d.firstChild.nodeType)e(d.nodeName,sifPlayer._toSifValue(d.firstChild.nodeValue));else switch(g){case "param":a[d.getAttribute("name")]=sifPlayer._getData(d);break;case "layer":"undefined"==
typeof a[g]&&(a[g]=[]);switch(d.getAttribute("type")){case "rotate":case "translate":case "zoom":case "stretch":e("layer",{_type:"restore"});a.layer.unshift(sifPlayer._getData(d));break;default:e(d.nodeName,sifPlayer._getData(d))}break;case "waypoint":"undefined"==typeof a[g]&&(a[g]=[]);default:e(g,sifPlayer._getData(d))}return a};sifPlayer._secsToMillis=function(f){return 1E3*parseFloat(f.replace("s",""))};sifPlayer._canvasTimeToMillis=function(f,e){var a=0,b;0<f.search("h")&&(b=f.split("h"),a+=
36E5*b[0],f=b[1]);0<f.search("m")&&(b=f.split("m"),a+=6E4*b[0],f=b[1]);0<f.search("s")&&(b=f.split("s"),a+=1E3*b[0],f=b[1]);0<f.search("f")&&(b=f.split("f"),a+=1E3*b[0]/e);return a};sifPlayer._getLayer=function(f,e){if(sifPlayer[e._type])return new sifPlayer[e._type](f,e);if("import"===e._type)return new sifPlayer.Import(f,e);console.log("EERRROOR  "+e._type+" layer it's not supported");var a=new sifPlayer.Layer;a.initLayer(f,e);return a};sifPlayer._toSifValue=function(f){var e=Number(f);return!isNaN(e)?
e:"true"===f?!0:"false"===f?!1:":"===f[0]?f.substr(1):f};sifPlayer._getEase=function(f){return"linear"===f?createjs.Ease.linear:"clamped"===f||"halt"===f?createjs.Ease.none:"constant"===f?sifPlayer.Ease.constant:"auto"===f?createjs.Ease.none:!1};window.sifPlayer=sifPlayer})();(function(){Ease={constant:function(f){return 1>f?0:1},bool:function(f){return 1>f?1:0}};sifPlayer.Ease=Ease})();(function(){function f(a,b){if(b)for(c in b)this[c]=b[c];this.sifPath=this.sifPath||"";this.init(a);this.canvas=document.createElement("canvas")}var e=f.prototype;e.x=0;e.y=0;e.width=320;e.height=240;e.sifPath="";e.timeline=null;e.desc={};e.init=function(a){a=sifPlayer._getData(a.getElementsByTagName("canvas")[0]);this.timeline=new createjs.Timeline;this.timeline.setPaused(!0);this._getCanvasData(a)};e.draw=function(a){var b=this.sif.canvas,d=this.sif.canvas.layer,g=b.bgcolor;a.clearRect(this.x,this.y,
this.width,this.height);a.beginPath();a.rect(this.x,this.y,this.width,this.height);a.closePath();a.clip();a.save();a.setTransform(this.width/(b.view_box[2]-b.view_box[0]),0,0,this.height/(b.view_box[3]-b.view_box[1]),this.x+this.width/2,this.y+this.height/2);for(b=0;b<d.length;b++)d[b].draw(a);a.restore();a.globalAlpha=1;a.globalCompositeOperation="destination-over";a.fillStyle="rgba("+g.r+", "+g.g+", "+g.b+", "+g.a+")";a.fillRect(this.x,this.y,this.width,this.height)};e._getCanvasData=function(a){this.sif=
{};this.sif.canvas={};this.sif.canvas.version=a._version;this.sif.canvas.width=a._width;this.sif.canvas.height=a._height;var b=a["_view-box"].split(" ");this.sif.canvas.view_box=[parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])];this.sif.canvas.antialias=a._antialias;this.sif.canvas.fps=a._fps;this.sif.canvas.begin_time=sifPlayer._canvasTimeToMillis(a["_begin-time"],this.sif.canvas.fps);this.sif.canvas.end_time=sifPlayer._canvasTimeToMillis(a["_end-time"],this.sif.canvas.fps);b=
a._bgcolor.split(" ");this.sif.canvas.bgcolor={};this.sif.canvas.bgcolor.r=Math.round(256*parseFloat(b[0]));this.sif.canvas.bgcolor.g=Math.round(256*parseFloat(b[1]));this.sif.canvas.bgcolor.b=Math.round(256*parseFloat(b[2]));this.sif.canvas.bgcolor.a=parseFloat(b[3]);this.sif.canvas.name=a.name;this.sif.canvas.defs=this._getDefs(a.defs);this.sif.canvas.layer=[];this.timeline.duration=this.sif.canvas.end_time;for(b=0;b<a.layer.length;b++)this.sif.canvas.layer.push(sifPlayer._getLayer(this,a.layer[b]))};
e._getDefs=function(a){var b={};for(name in a)if(a[name].constructor!=Array)"animated"===name?(b[a[name]._id]={},b[a[name]._id].animated=a[name]):(b[a[name]._id]={},b[a[name]._id][name]=a[name],b[a[name]._id]._type=name);else for(var d=0;d<a[name].length;d++)"animated"===name?(b[a[name][d]._id]={},b[a[name][d]._id].animated=a[name][d]):(b[a[name][d]._id]={},b[a[name][d]._id][name]=a[name][d],b[a[name][d]._id]._type=name);return b};sifPlayer.SifObject=f})();this.sifPlayer=this.sifPlayer||{};this.sifPlayer.param=this.sifPlayer.param||{};
(function(){var f=sifPlayer.param;f._set=function(e,a,b,d,g){var i;g||alert(JSON.stringify(g)+this.type+"  "+a);g.animated&&(i=g.animated._type);g._type&&(i=g._type);g._use?f._set(e,a,b,d,e.sifobj.sif.canvas.defs[g._use]):g.vector||"vector"===i?f.vector._get(e,a,b,d,g):g.integer||"integer"===i?f._getNumber(e,a,b,d,g,"integer"):g.real||"real"===i?f._getNumber(e,a,b,d,g,"real"):g.angle||"angle"===i?f._getNumber(e,a,b,d,g,"angle"):g.bool||"bool"===i?f.bool._get(e,a,b,d,g):g.color||"color"===i?f._getColor(e,
a,b,d,g):g.gradient||"gradient"===i?f._getGradient(e,a,b,d,g):g.composite?f.composite._get(e,a,b,d,g):g.scale||"scale"===i?(d[a]={},d[a].scale={},f._set(e,"link",g.scale._type,d[a].scale,g.scale.link),f._set(e,"scalar","real",d[a].scale,g.scale.scalar),f.convert._set(e,d[a],b,"scale")):g.radial_composite||"radial_composite"===i?f._getRadial_composite(e,a,b,d,g):g.add?(i=g.add._type,d[a]={},d[a].add={},f._set(e,"lhs",i,d[a].add,g.add.lhs),f._set(e,"rhs",i,d[a].add,g.add.rhs),f._set(e,"scalar","real",
d[a].add,g.add.scalar),f.convert._set(e,d[a],b,"add")):g.and?(i=g.and._type,d[a]={},d[a].and={},f._set(e,"link1",i,d[a].and,g.and.link1),f._set(e,"link2",i,d[a].and,g.and.link2),f.convert._set(e,d[a],b,"and")):g.atan2?(d[a]={},d[a].atan2={},g.atan2._x&&(g.atan2.x=e.sifobj.sif.canvas.defs[g.atan2._x]),g.atan2._y&&(g.atan2.y=e.sifobj.sif.canvas.defs[g.atan2._y]),f._set(e,"x","real",d[a].atan2,g.atan2.x),f._set(e,"y","real",d[a].atan2,g.atan2.y),f.convert._set(e,d[a],b,"atan2")):g.cos?(d[a]={},d[a].cos=
{},g.cos._angle&&(g.cos.angle=e.sifobj.sif.canvas.defs[g.cos._angle]),g.cos._amp&&(g.cos.amp=e.sifobj.sif.canvas.defs[g.cos._amp]),f._set(e,"angle","angle",d[a].cos,g.cos.angle),f._set(e,"amp","real",d[a].cos,g.cos.amp),f.convert._set(e,d[a],b,"cos")):g.dotproduct?(d[a]={},d[a].dotproduct={},g.dotproduct._lhs&&(g.dotproduct.lhs=e.sifobj.sif.canvas.defs[g.dotproduct._lhs]),g.dotproduct._rhs&&(g.dotproduct.rhs=e.sifobj.sif.canvas.defs[g.dotproduct._rhs]),f._set(e,"lhs","vector",d[a].dotproduct,g.dotproduct.lhs),
f._set(e,"rhs","vector",d[a].dotproduct,g.dotproduct.rhs),f.convert._set(e,d[a],b,"dotproduct")):g.exp?(d[a]={},d[a].exp={},g.exp._exp&&(g.exp.exp=e.sifobj.sif.canvas.defs[g.exp._exp]),g.exp._scale&&(g.exp.scale=e.sifobj.sif.canvas.defs[g.exp._scale]),f._set(e,"exp","real",d[a].exp,g.exp.exp),f._set(e,"scale","real",d[a].exp,g.exp.scale),f.convert._set(e,d[a],b,"exp")):g.logarithm?(d[a]={},d[a].logarithm={},g.logarithm._link&&(g.logarithm.link=e.sifobj.sif.canvas.defs[g.logarithm._link]),f._set(e,
"link","real",d[a].logarithm,g.logarithm.link),f._set(e,"epsilon","real",d[a].logarithm,g.logarithm.epsilon),f._set(e,"infinite","real",d[a].logarithm,g.logarithm.infinite),f.convert._set(e,d[a],b,"logarithm")):g.greyed?f._set(e,a,b,d,g.greyed.link):(alert("no param type"),alert(JSON.stringify(g)+" layer type : "+e.type))};f._getNumber=function(e,a,b,d,g,i){var h,j;h={paused:!0,useTick:!0};var k=e.sifobj.timeline,m;d[a]={};if(g.animated){g=g.animated.waypoint;d[a].value=g[0][i]._value;h=createjs.Tween.get(d[a],
h);"0s"!==g[0]._time&&(m=sifPlayer._getEase(g[0]._before),j=sifPlayer._secsToMillis(g[0]._time),h.to({value:g[0][i]._value},j,m));for(var l=0;l<g.length-1;l++)m=sifPlayer._getEase(g[l+1]._before),j=sifPlayer._secsToMillis(g[l+1]._time)-sifPlayer._secsToMillis(g[l]._time),g[l][i]._value!==g[l+1][i]._value?h.to({value:g[l+1][i]._value},j,m):h.wait(j);k.addTween(h)}else g[i]||alert(JSON.stringify(g)+"param_type : "+i+" param_name : "+a+" layer type : "+this.type),d[a].value=g[i]._value;f.convert._set(e,
d[a],b,i)};f._getRadial_composite=function(e,a,b,d,g){param_type="radial_composite";d[a]={};d[a]._type=param_type;d[a].radial_composite={};g[param_type]._radius&&(g[param_type].radius=e.sifobj.sif.canvas.defs[g[param_type]._radius]);g[param_type]._theta&&(g[param_type].theta=e.sifobj.sif.canvas.defs[g[param_type]._theta]);f._set(e,"radius","real",d[a][param_type],g[param_type].radius);f._set(e,"theta","angle",d[a][param_type],g[param_type].theta);f.convert._set(e,d[a],b,param_type)};f._getColor=function(e,
a,b,d,g){b={paused:!0,useTick:!0};e=e.sifobj.timeline;d[a]={};d[a].animated=!0;if(g.animated){w=g.animated.waypoint;d[a].r=w[0].color.r;d[a].g=w[0].color.g;d[a].b=w[0].color.b;d[a].a=w[0].color.a;tw=createjs.Tween.get(d[a],b);"0s"!==w[0]._time&&tw.to({r:w[0].color.r,g:w[0].color.g,b:w[0].color.b,a:w[0].color.a},sifPlayer._secsToMillis(w[0]._time),sifPlayer._getEase(w[0]._before));for(a=0;a<w.length-1;a++)tw.to({r:w[a+1].color.r,g:w[a+1].color.g,b:w[a+1].color.b,a:w[a+1].color.a},sifPlayer._secsToMillis(w[a+
1]._time)-sifPlayer._secsToMillis(w[a]._time),sifPlayer._getEase(w[a+1]._before));e.addTween(tw)}else d[a].r=g.color.r,d[a].g=g.color.g,d[a].b=g.color.b,d[a].a=g.color.a};f._getGradient=function(e,a,b,d,g,f){f="gradient";b={paused:!0,useTick:!0};e=e.sifobj.timeline;d[a]={};var h;if(g.animated){w=g.animated.waypoint;d[f]={};d[f].color=[];for(var j=0,k=w[0].gradient.color.length;j<k;j++){d[f].color.push({});h=d[f].color[j];a=w[0].gradient.color[j];h.pos=a._pos;h.r=a.r;h.g=a.g;h.b=a.b;h.a=a.a;tw=createjs.Tween.get(h,
b);"0s"!==w[0]._time&&tw.to({pos:a._pos,r:a.r,g:a.g,b:a.b,a:a.a},sifPlayer._secsToMillis(w[0]._time),sifPlayer._getEase(w[0]._before));g=0;for(h=w.length-1;g<h;g++)a=w[g+1].gradient.color[j],tw.to({pos:a._pos,r:a.r,g:a.g,b:a.b,a:a.a},sifPlayer._secsToMillis(w[g+1]._time)-sifPlayer._secsToMillis(w[g]._time),sifPlayer._getEase(w[g+1]._before));e.addTween(tw)}}else{d[f]={};d[f].color=[];j=0;for(k=g[f].color.length;j<k;j++)d[f].color.push({}),h=d[f].color[j],a=g[f].color[j],h.pos=a._pos,h.r=a.r,h.g=a.g,
h.b=a.b,h.a=a.a}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){sifPlayer.param.vector={_get:function(f,e,a,b,d){var g,i;g={paused:!0,useTick:!0};var h=f.sifobj.timeline;b[e]={};if(d.animated){d=d.animated.waypoint;b[e].x=d[0].vector.x;b[e].y=d[0].vector.y;g=createjs.Tween.get(b[e],g);"0s"!==d[0]._time&&(i=sifPlayer._secsToMillis(d[0]._time),g.to({x:d[0].vector.x,y:d[0].vector.y},i,sifPlayer._getEase(d[0]._before)));for(var j=0;j<d.length-1;j++)i=sifPlayer._secsToMillis(d[j+1]._time)-sifPlayer._secsToMillis(d[j]._time),d[j].vector.x!==d[j+1].vector.x&&
d[j].vector.y!==d[j+1].vector.y?g.to({x:d[j+1].vector.x,y:d[j+1].vector.y},i,sifPlayer._getEase(d[j+1]._before)):g.wait(i);h.addTween(g);sifPlayer.param.convert._set(f,b[e],a,"vector")}else d.vector?(b[e].x=d.vector.x,b[e].y=d.vector.y,sifPlayer.param.convert._set(f,b[e],a,"vector",!1)):alert(JSON.stringify(d)+" in vector")},_setConvert:function(f,e,a,b){f=sifPlayer.param.vector;a===b?(e.getX=f.getX,e.getY=f.getY):"radial_composite"===b?(e.getX=f.getRadialX,e.getY=f.getRadialY):"composite"===b?(e.getX=
f.getCompositeX,e.getY=f.getCompositeY):"add"===b?(e.getX=f.getAddX,e.getY=f.getAddY):"scale"===b&&(e.scale.composite?(e.getX=f.getScaleCompositeX,e.getY=f.getScaleCompositeY):e.scale.radial_composite?(e.getX=f.getScaleRadialX,e.getY=f.getScaleRadialY):(e.getX=f.getScaleX,e.getY=f.getScaleY))},getX:function(){return this.x},getY:function(){return this.y},getScaleX:function(){return this.scale.link.getX()*this.scale.scalar.getValue()},getScaleY:function(){return this.scale.link.getY()*this.scale.scalar.getValue()},
getScaleCompositeX:function(){return this.scale.composite.x.getValue()*this.scalar.getValue()},getScaleCompositeY:function(){return this.scale.composite.y.getValue()*this.scalar.getValue()},getScaleRadialX:function(){var f=this.scale.radial_composite.theta.getValue()*Math.PI/180,e=this.scale.radial_composite.radius.getValue();return Math.cos(f)*e*this.scalar.getValue()},getScaleRadialY:function(){var f=this.scale.radial_composite.theta.getValue()*Math.PI/180,e=this.scale.radial_composite.radius.getValue();
return Math.sin(f)*e*this.scalar.getValue()},getRadialX:function(){var f=this.radial_composite.theta.getValue()*Math.PI/180,e=this.radial_composite.radius.getValue();return Math.cos(f)*e},getRadialY:function(){var f=this.radial_composite.theta.getValue()*Math.PI/180,e=this.radial_composite.radius.getValue();return Math.sin(f)*e},getCompositeX:function(){return this.composite.x.getValue()},getCompositeY:function(){return this.composite.y.getValue()},getAddX:function(){return(this.add.lhs.getX()+this.add.rhs.getX())*
this.add.scalar.getValue()},getAddY:function(){return(this.add.lhs.getY()+this.add.rhs.getY())*this.add.scalar.getValue()}}})();this.sifPlayer.param=this.sifPlayer.param||{};(function(){sifPlayer.param.integer={_setConvert:function(f,e,a,b){f=sifPlayer.param.integer;a===b?e.getValue=f.getValue:f[b]?e.getValue=f[b]:alert("no convert for integer to "+b)},getValue:function(){return this.value},add:function(){return(this.add.lhs.getValue()+this.add.rhs.getValue())*this.add.scalar.getValue()},scale:function(){return this.scale.link.getValue()*this.scale.scalar.getValue()}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){sifPlayer.param.real={_setConvert:function(f,e,a,b){f=sifPlayer.param.real;a===b?e.getValue=f.getValue:f[b]?e.getValue=f[b]:alert("no convert for real to "+b)},getValue:function(){return this.value},add:function(){return(this.add.lhs.getValue()+this.add.rhs.getValue())*this.add.scalar.getValue()},scale:function(){return this.scale.link.getValue()*this.scale.scalar.getValue()},cos:function(){return this.cos.amp.getValue()*Math.cos(this.cos.angle.getValue())},dotproduct:function(){var f,
e,a,b;f=this.dotproduct.lhs.getX();e=this.dotproduct.lhs.getY();a=this.dotproduct.rhs.getX();b=this.dotproduct.rhs.getY();return f*a+e*b},exp:function(){return Math.exp(this.exp.exp.getValue())*this.exp.scale.getValue()},logarithm:function(){var f=this.logarithm.link.getValue();return f>=this.logarithm.epsilon.getValue()?Math.log(f):-this.logarithm.infinite.getValue()}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){sifPlayer.param.angle={_setConvert:function(f,e,a,b){f=sifPlayer.param.angle;a===b?e.getValue=f.getValue:f[b]?e.getValue=f[b]:alert("no convert for angle to "+b)},getValue:function(){return this.value},add:function(){return(this.add.lhs.getValue()+this.add.rhs.getValue())*this.add.scalar.getValue()},scale:function(){return this.scale.link.getValue()*this.scale.scalar.getValue()},atan2:function(){return 180*(Math.atan2(this.atan2.y.getValue(),this.atan2.x.getValue())/Math.PI)},dotproduct:function(){var f,
e,a,b;f=this.dotproduct.lhs.getX();e=this.dotproduct.lhs.getY();a=this.dotproduct.rhs.getX();b=this.dotproduct.rhs.getY();return 180*(Math.acos((f*a+e*b)/(Math.sqrt(f*f+e*e)*Math.sqrt(a*a+b*b)))/Math.PI)}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){sifPlayer.param.bool={_get:function(f,e,a,b,d){var g=sifPlayer.param,i,h;i={paused:!0,useTick:!0};var j=f.sifobj.timeline,k,m=0,l=[0,1];b[e]={};if(d.animated){d=d.animated.waypoint;b[e].value=d[0].bool._value;i=createjs.Tween.get(b[e],i);"0s"!==d[0]._time&&(k=sifPlayer.Ease.bool,h=sifPlayer._secsToMillis(d[0]._time),i.to({value:d[0].bool._value},h,k));for(var n=0;n<d.length-1;n++)k=l[1-m]?sifPlayer.Ease.bool:sifPlayer.Ease.constant,m=1-m,h=sifPlayer._secsToMillis(d[n+1]._time)-sifPlayer._secsToMillis(d[n]._time),
d[n].bool._value!==d[n+1].bool._value?i.to({value:d[n+1].bool._value},h,k):i.wait(h);j.addTween(i)}else d.bool||alert(JSON.stringify(d)+"param_type : bool param_name : "+e+" layer type : "+this.type),b[e].value=d.bool._value;g.convert._set(f,b[e],a,"bool")},_setConvert:function(f,e,a,b){f=sifPlayer.param.bool;a===b?e.getValue=f.getValue:"and"===b&&(e.getValue=f.getAnd)},getValue:function(){return this.value},getAnd:function(){return this.link1&&this.link2}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){var f={_get:function(e,a,b,d,g){var f=sifPlayer.param,h=f._set,j="composite";d[a]={};d[a]._type=j;d[a].composite={};if("vector"===g.composite._type)g[j]._x&&(g[j].x=e.sifobj.sif.canvas.defs[g[j]._x]),g[j]._y&&(g[j].y=e.sifobj.sif.canvas.defs[g[j]._y]),h(e,"x","real",d[a].composite,g.composite.x),h(e,"y","real",d[a].composite,g.composite.y),f.convert._set(e,d[a],b,j);else if("bline_point"===g.composite._type){var k=d[a].composite,j=g.composite._type;h(e,"point","vector",k,g.composite.point);
h(e,"width","real",k,g.composite.width);h(e,"origin","real",k,g.composite.origin);h(e,"split","bool",k,g.composite.split);h(e,"t1","vector",k,g.composite.t1);h(e,"t2","vector",k,g.composite.t2);f.convert._set(e,d[a].composite,b,j,g.composite.point.animated||g.composite.width.animated||g.composite.origin.animated||g.composite.t1.animated||g.composite.t2.animated)}},_setConvert:function(e,a,b,d){"bline_point"===d?(a.getPoint=f.getPoint,a.getT1=f.bline_point_getT1,a.getT2=f.bline_point_getT2):alert("new type of point")},
getPoint:function(){return this.point},bline_point_getPoint:function(){return this.point},bline_point_getT1:function(){return{x:this.t1.getX()/3,y:this.t1.getY()/3}},bline_point_getT2:function(){return{x:this.t2.getX()/3,y:this.t2.getY()/3}}};sifPlayer.param.composite=f})();this.sifPlayer.param=this.sifPlayer.param||{};this.sifPlayer.param.convert=this.sifPlayer.param.convert||{};(function(){sifPlayer.param.convert._set=function(f,e,a,b){"vector"===a?sifPlayer.param[a]._setConvert(f,e,a,b):"real"===a?sifPlayer.param[a]._setConvert(f,e,a,b):"integer"===a?sifPlayer.param[a]._setConvert(f,e,a,b):"angle"===a?sifPlayer.param[a]._setConvert(f,e,a,b):"bool"===a?sifPlayer.param[a]._setConvert(f,e,a,b):"composite"===a&&sifPlayer.param[a]._setConvert(f,e,a,b)}})();(function(){function f(){}var e=f.prototype;e.parent=null;e.sifobj=null;e.type=null;e.initLayer=function(a,b){a.hasOwnProperty("sifPath")?this.sifobj=a:(this.parent=a,this.sifobj=a.sifobj);this.type=b._type;b._desc&&(this.desc=b._desc,this.sifobj.desc[this.desc]=this);this.tween=[]};e.draw=function(){};e._getBlend=function(){switch(this.blend_method.getValue()){case 0:return"source-over";case 1:return"copy";case 13:return"source-atop";case 21:return"source-in";case 12:return"destination-over";case 19:return"destination-out";
case 14:return"destination-in";default:return"source-over"}};e._getTotalAmount=function(){var a=this.amount.getValue(),b=this.parent;return b?b._getTotalAmount()*a:a};sifPlayer.Layer=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"blend_method","integer",this,b.blend_method);d(this,"amount","real",this,b.amount);d(this,"origin","vector",this,b.origin);d(this,"color","color",this,b.color);this._getBline(b.bline)};e.draw=function(a){var b,d;a.fillStyle="rgba("+Math.round(256*this.color.r)+", "+Math.round(256*this.color.g)+", "+Math.round(256*this.color.b)+", "+this.color.a+
")";a.globalAlpha=this._getTotalAmount();a.save();a.translate(this.origin.getX(),this.origin.getY());a.globalCompositeOperation=this._getBlend();a.beginPath();b=this.bline.entry[0].composite.getPoint();a.moveTo(b.getX(),b.getY());for(var g=0;g<this.bline.entry.length-1;g++)b=this.bline.entry[g].composite,d=this.bline.entry[g+1].composite,b.split.getValue()?this._bezierPart(a,b.getPoint(),d.getPoint(),b.getT2(),d.getT1()):this._bezierPart(a,b.getPoint(),d.getPoint(),b.getT1(),d.getT1());this.bline.loop&&
(b=this.bline.entry[this.bline.entry.length-1].composite,d=this.bline.entry[0].composite,b.split.getValue()?this._bezierPart(a,b.getPoint(),d.getPoint(),b.getT2(),d.getT1()):this._bezierPart(a,b.getPoint(),d.getPoint(),b.getT1(),d.getT1()));a.closePath();a.fill();a.restore()};e._getBline=function(a){var b=sifPlayer.param._set;this.bline={};this.bline.entry=[];this.bline.loop=a.bline._loop;for(var d=0,g=a.bline.entry.length;d<g;d++){var e={};b(this,"composite","composite",e,a.bline.entry[d]);this.bline.entry.push(e.composite)}};
e._bezierPart=function(a,b,d,e,f){var h;h=e.x+b.getX();b=e.y+b.getY();e=-f.x+d.getX();f=-f.y+d.getY();a.bezierCurveTo(h,b,e,f,d.getX(),d.getY())};sifPlayer.region=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"blend_method","integer",this,b.blend_method);d(this,"amount","real",this,b.amount);d(this,"width","real",this,b.width);d(this,"origin","vector",this,b.origin);d(this,"color","color",this,b.color);this._getBline(b.bline)};e.draw=function(a){var b,d;a.fillStyle="rgba("+Math.round(256*this.color.r)+", "+Math.round(256*this.color.g)+", "+Math.round(256*
this.color.b)+", "+this.color.a+")";a.globalAlpha=this._getTotalAmount();a.save();a.translate(this.origin.getX(),this.origin.getY());a.globalCompositeOperation=this._getBlend();a.beginPath();b=this.bline.entry[0].composite.getPoint();a.moveTo(b.getX(),b.getY());for(var e=0;e<this.bline.entry.length-1;e++)b=this.bline.entry[e].composite,d=this.bline.entry[e+1].composite,b.split.getValue()?this._bezierPart(a,b.getPoint(),d.getPoint(),b.getT2(),d.getT1()):this._bezierPart(a,b.getPoint(),d.getPoint(),
b.getT1(),d.getT1());this.bline.loop&&(b=this.bline.entry[this.bline.entry.length-1].composite,d=this.bline.entry[0].composite,b.split.getValue()?this._bezierPart(a,b.getPoint(),d.getPoint(),b.getT2(),d.getT1()):this._bezierPart(a,b.getPoint(),d.getPoint(),b.getT1(),d.getT1()));a.lineWidth=this.width.getValue();a.stroke();a.restore()};e._getBline=function(a){var b=sifPlayer.param._set;this.bline={};this.bline.entry=[];this.bline.loop=a.bline._loop;for(var d=0,e=a.bline.entry.length;d<e;d++){var f=
{};b(this,"composite","composite",f,a.bline.entry[d]);this.bline.entry.push(f.composite)}};e._bezierPart=function(a,b,d,e,f){var h;h=e.x+b.getX();b=e.y+b.getY();e=-f.x+d.getX();f=-f.y+d.getY();a.bezierCurveTo(h,b,e,f,d.getX(),d.getY())};sifPlayer.outline=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"amount","real",this,b.amount);d(this,"origin","vector",this,b.origin);d(this,"radius","real",this,b.radius);d(this,"blend_method","integer",this,b.blend_method);d(this,"color","color",this,b.color)};e.draw=function(a){var b=this.origin;a.fillStyle="rgba("+Math.round(256*this.color.r)+", "+Math.round(256*this.color.g)+", "+Math.round(256*this.color.b)+
", "+this.color.a+")";a.globalAlpha=this._getTotalAmount();a.globalCompositeOperation=this._getBlend();a.beginPath();a.arc(b.getX(),b.getY(),this.radius.getValue(),0,2*Math.PI,!1);a.closePath();a.fill()};sifPlayer.circle=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"amount","real",this,b.amount);d(this,"blend_method","integer",this,b.blend_method);d(this,"tl","vector",this,b.tl);d(this,"br","vector",this,b.br);this.image=new Image;this.image.src=this.sifobj.sifPath+b.filename.string};e.draw=function(a){a.save();a.globalAlpha=this._getTotalAmount();a.globalCompositeOperation=this._getBlend();this._drawImage(a);
a.restore()};e._drawImage=function(a){var b=this.br.getX()-this.tl.getX(),d=this.tl.getY()-this.br.getY(),e,f;0>=b?(e=-1,b*=-1):e=1;0>=d?(f=1,d*=-1):f=-1;a.translate(this.tl.getX(),this.tl.getY());a.scale(e,f);a.drawImage(this.image,0,0,b,d)};sifPlayer.Import=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"amount","real",this,b.amount);d(this,"blend_method","integer",this,b.blend_method);d(this,"p1","vector",this,b.p1);d(this,"p2","vector",this,b.p2);d(this,"gradient","gradient",this,b.gradient)};e.draw=function(a){for(var b=a.createLinearGradient(this.p1.getX(),this.p1.getY(),this.p2.getX(),this.p2.getY()),d=this.gradient.color,e=0,f=d.length;e<
f;e++)b.addColorStop(d[e].pos,"rgba("+Math.round(256*d[e].r)+", "+Math.round(256*d[e].g)+", "+Math.round(256*d[e].b)+", "+d[e].a+")");a.globalAlpha=this._getTotalAmount();a.globalCompositeOperation=this._getBlend();a.fillStyle=b;a.fillRect(-1E3,-1E3,2E3,2E3)};sifPlayer.linear_gradient=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"amount","real",this,b.amount);d(this,"blend_method","integer",this,b.blend_method);d(this,"origin","vector",this,b.origin);d(this,"zoom","real",this,b.zoom);d(this,"focus","vector",this,b.focus);this._getLayers(b.canvas.canvas.layer)};e._getLayers=function(a){this.layer=[];for(var b=0;b<a.length;b++)this.layer.push(sifPlayer._getLayer(this,a[b]))};
e.draw=function(a){var b=Math.exp(this.zoom.getValue()),d=this.layer,e=this.focus,f=this.origin;a.save();a.translate(e.getX(),e.getY());a.scale(b,b);a.translate(-e.getX(),-e.getY());a.translate(f.getX()/b,f.getY()/b);b=0;for(e=d.length;b<e;b++)d[b].draw(a);a.restore()};sifPlayer.PasteCanvas=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"amount","real",this,b.amount);d(this,"blend_method","integer",this,b.blend_method);d(this,"center","vector",this,b.center);d(this,"radius","real",this,b.radius);d(this,"gradient","gradient",this,b.gradient)};e.draw=function(a){for(var b=this.center.getX(),d=this.center.getY(),b=a.createRadialGradient(b,d,0,b,d,this.radius.getValue()),d=this.gradient.color,
e=0,f=d.length;e<f;e++)b.addColorStop(d[e].pos,"rgba("+Math.round(256*d[e].r)+", "+Math.round(256*d[e].g)+", "+Math.round(256*d[e].b)+", "+d[e].a+")");a.globalAlpha=this._getTotalAmount();a.globalCompositeOperation=this._getBlend();a.fillStyle=b;a.fillRect(-1E3,-1E3,2E3,2E3)};sifPlayer.radial_gradient=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){this.initLayer(a,b)};e.draw=function(a){a.restore()};sifPlayer.restore=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"origin","vector",this,b.origin);d(this,"amount","angle",this,b.amount)};e.draw=function(a){a.save();a.translate(this.origin.getX(),this.origin.getY());a.rotate(this.amount.value*Math.PI/180);a.translate(-this.origin.getX(),-this.origin.getY())};sifPlayer.rotate=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"amount","vector",this,b.amount);d(this,"center","vector",this,b.center)};e.draw=function(a){var b=this.center,d=this.amount;a.save();a.translate(b.getX(),b.getY());a.scale(d.getX(),d.getY());a.translate(-b.getX(),-b.getY())};sifPlayer.stretch=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"origin","vector",this,b.origin)};e.draw=function(a){var b=this.origin;a.save();a.translate(b.getX(),b.getY())};sifPlayer.translate=f})();(function(){function f(a,b){this.init(a,b)}var e=f.prototype=new sifPlayer.Layer;e.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"center","vector",this,b.center);d(this,"amount","real",this,b.amount)};e.draw=function(a){var b=Math.exp(this.amount.getValue()),d=this.center;a.save();a.translate(d.getX(),d.getY());a.scale(b,b);a.translate(-d.getX()/b,-d.getY()/b)};sifPlayer.zoom=f})();
