/*
 Copyright (c) 2012 haramanai.
 sifPlayer
 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
*/
this.sifPlayer=this.sifPlayer||{};
(function(){sifPlayer._getData=function(e){function b(f,d){a[f]?(a[f].constructor!=Array&&(a[f]=[a[f]]),a[f][a[f].length]=d):a[f]=d}var a={},f,d,g;for(f=0;d=e.attributes[f];f++)b("_"+d.name,sifPlayer._toSifValue(d.value));for(f=0;d=e.childNodes[f];f++)if(1==d.nodeType)if(g=d.nodeName,1==d.childNodes.length&&3==d.firstChild.nodeType)b(d.nodeName,sifPlayer._toSifValue(d.firstChild.nodeValue));else switch(g){case "param":a[d.getAttribute("name")]=sifPlayer._getData(d);break;case "layer":"undefined"==
typeof a[g]&&(a[g]=[]);switch(d.getAttribute("type")){case "rotate":case "translate":case "zoom":case "stretch":b("layer",{_type:"restore"});a.layer.unshift(sifPlayer._getData(d));break;case "timeloop":a.layer.unshift(sifPlayer._getData(d));break;default:b(d.nodeName,sifPlayer._getData(d))}break;case "waypoint":"undefined"==typeof a[g]&&(a[g]=[]);default:b(g,sifPlayer._getData(d))}return a};sifPlayer._secsToMillis=function(e){return 1E3*parseFloat(e.replace("s",""))};sifPlayer._canvasTimeToMillis=
function(e,b){var a=0,f;0<e.search("h")&&(f=e.split("h"),a+=36E5*f[0],e=f[1]);0<e.search("m")&&(f=e.split("m"),a+=6E4*f[0],e=f[1]);0<e.search("s")&&(f=e.split("s"),a+=1E3*f[0],e=f[1]);0<e.search("f")&&(f=e.split("f"),a+=1E3*f[0]/b);return a};sifPlayer._getLayer=function(e,b){if(sifPlayer[b._type])return new sifPlayer[b._type](e,b);if("import"===b._type)return new sifPlayer.Import(e,b);console.log("EERRROOR  "+b._type+" layer it's not supported");var a=new sifPlayer.Layer;a.initLayer(e,b);return a};
sifPlayer._toSifValue=function(e){var b=Number(e);return!isNaN(b)?b:"true"===e?!0:"false"===e?!1:":"===e[0]?e.substr(1):e};sifPlayer._getEase=function(e){return"linear"===e||"clamped"===e||"halt"===e?createjs.Ease.none:"constant"===e?sifPlayer.Ease.constant:"auto"===e?createjs.Ease.none:!1};window.sifPlayer=sifPlayer})();(function(){function e(a){this.ctx=a;this.matrix=[1,0,0,1,0,0];this.stack=[];this.setTransform()}var b=e.prototype;b.setContext=function(a){this.ctx=a};b.getMatrix=function(){return this.matrix};b.setMatrix=function(a){this.matrix=[a[0],a[1],a[2],a[3],a[4],a[5]];this.setTransform()};b.cloneMatrix=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5]]};b.save=function(){var a=this.cloneMatrix(this.getMatrix());this.stack.push(a);this.ctx&&this.ctx.save()};b.restore=function(){if(0<this.stack.length){var a=
this.stack.pop();this.setMatrix(a)}this.ctx&&this.ctx.restore()};b.setTransform=function(){this.ctx&&this.ctx.setTransform(this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5])};b.translate=function(a,f){this.matrix[4]+=this.matrix[0]*a+this.matrix[2]*f;this.matrix[5]+=this.matrix[1]*a+this.matrix[3]*f;this.setTransform()};b.rotate=function(a){var f=Math.cos(a),a=Math.sin(a),d=this.matrix[1]*f+this.matrix[3]*a,g=this.matrix[0]*-a+this.matrix[2]*f,b=this.matrix[1]*
-a+this.matrix[3]*f;this.matrix[0]=this.matrix[0]*f+this.matrix[2]*a;this.matrix[1]=d;this.matrix[2]=g;this.matrix[3]=b;this.setTransform()};b.scale=function(a,f){this.matrix[0]*=a;this.matrix[1]*=a;this.matrix[2]*=f;this.matrix[3]*=f;this.setTransform()};sifPlayer.Tracker=e})();(function(){Ease={constant:function(e){return 1>e?0:1},bool:function(e){return 1>e?1:0}};sifPlayer.Ease=Ease})();(function(){function e(a,f){if(f)for(c in f)this[c]=f[c];this.sifPath=this.sifPath||"";this.init(a)}var b=e.prototype;b.x=0;b.y=0;b.width=320;b.height=240;b.sifPath="";b.timeline=null;b.desc={};b.init=function(a){a=sifPlayer._getData(a.getElementsByTagName("canvas")[0]);this.timeline=new createjs.Timeline;this.timeline.setPaused(!0);this._getCanvasData(a);this.dCanvas=this.sif.canvas.pCanvas.dCanvas};b._getCanvasData=function(a){this.sif={};this.sif.canvas={};this.sif.canvas.version=a._version;this.sif.canvas.width=
a._width;this.sif.canvas.height=a._height;var f=a["_view-box"].split(" ");this.sif.canvas.view_box=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])];this.sif.canvas.antialias=a._antialias;this.sif.canvas.fps=a._fps;this.sif.canvas.begin_time=sifPlayer._canvasTimeToMillis(a["_begin-time"],this.sif.canvas.fps);this.sif.canvas.end_time=sifPlayer._canvasTimeToMillis(a["_end-time"],this.sif.canvas.fps);f=a._bgcolor.split(" ");this.sif.canvas.bgcolor={};this.sif.canvas.bgcolor.r=Math.round(256*
parseFloat(f[0]));this.sif.canvas.bgcolor.g=Math.round(256*parseFloat(f[1]));this.sif.canvas.bgcolor.b=Math.round(256*parseFloat(f[2]));this.sif.canvas.bgcolor.a=parseFloat(f[3]);this.sif.canvas.name=a.name;this.sif.canvas.defs=this._getDefs(a.defs);this.sif.canvas.pCanvas=sifPlayer.PasteCanvas.makeFake(this);this.sif.canvas.pCanvas.layer=[];this.timeline.duration=this.sif.canvas.end_time;for(f=0;f<a.layer.length;f++)this.sif.canvas.pCanvas.layer.push(sifPlayer._getLayer(this.sif.canvas.pCanvas,a.layer[f]))};
b._getDefs=function(a){var f={};for(name in a)if(a[name].constructor!=Array)"animated"===name?(f[a[name]._id]={},f[a[name]._id].animated=a[name]):(f[a[name]._id]={},f[a[name]._id][name]=a[name],f[a[name]._id]._type=name);else for(var d=0;d<a[name].length;d++)"animated"===name?(f[a[name][d]._id]={},f[a[name][d]._id].animated=a[name][d]):(f[a[name][d]._id]={},f[a[name][d]._id][name]=a[name][d],f[a[name][d]._id]._type=name);return f};b.draw=function(){var a=this.sif.canvas,f=this.tracker=new sifPlayer.Tracker;
f.matrix=[this.width/(a.view_box[2]-a.view_box[0]),0,0,this.height/(a.view_box[3]-a.view_box[1]),this.x+this.width/2,this.y+this.height/2];this.sif.canvas.pCanvas.draw(f)};b.tick=function(a){this.timeline.tick(a);this.sif.canvas.pCanvas.setPosition(this.timeline.position)};b.setPosition=function(a){this.timeline.setPosition(a);this.sif.canvas.pCanvas.setPosition(this.timeline.position)};sifPlayer.SifObject=e})();this.sifPlayer=this.sifPlayer||{};this.sifPlayer.param=this.sifPlayer.param||{};
(function(){var e=sifPlayer.param;e._set=function(b,a,f,d,g){var h;g||alert(JSON.stringify(g)+this.type+"  "+a);g.animated&&(h=g.animated._type);g._type&&(h=g._type);g._use?e._set(b,a,f,d,b.sifobj.sif.canvas.defs[g._use]):g.vector||"vector"===h?e.vector._get(b,a,f,d,g):g.integer||"integer"===h?e._getNumber(b,a,f,d,g,"integer"):g.real||"real"===h?e._getNumber(b,a,f,d,g,"real"):g.angle||"angle"===h?e._getNumber(b,a,f,d,g,"angle"):g.bool||"bool"===h?e.bool._get(b,a,f,d,g):g.time||"time"===h?e._getTime(b,
a,f,d,g):g.color||"color"===h?e._getColor(b,a,f,d,g):g.gradient||"gradient"===h?e._getGradient(b,a,f,d,g):g.composite?e.composite._get(b,a,f,d,g):g.bline_point?(d[a]={},d[a].composite={},g.bline_point.vertex?(e._set(b,"point","vector",d[a].composite,g.bline_point.vertex),e._set(b,"t1","vector",d[a].composite,g.bline_point.t1),d[a].composite.split={},d[a].composite.split.getValue=function(){return!1},e.convert._set(b,d[a].composite,f,"bline_point")):alert("not converted bline point")):g.scale||"scale"===
h?(d[a]={},d[a].scale={},g.scale._link&&(g.scale.link=b.sifobj.sif.canvas.defs[g.scale._link]),g.scale._scalar&&(g.scale.scalar=b.sifobj.sif.canvas.defs[g.scale._scalar]),e._set(b,"link",g.scale._type,d[a].scale,g.scale.link),e._set(b,"scalar","real",d[a].scale,g.scale.scalar),e.convert._set(b,d[a],f,"scale")):g.radial_composite||"radial_composite"===h?e._getRadial_composite(b,a,f,d,g):g.add?(h=g.add._type,d[a]={},d[a].add={},g.add._lhs&&(g.add.lhs=b.sifobj.sif.canvas.defs[g.add._lhs]),g.add._rhs&&
(g.add.rhs=b.sifobj.sif.canvas.defs[g.add._rhs]),g.add._scaler&&(g.add.scaler=b.sifobj.sif.canvas.defs[g.add._scaler]),e._set(b,"lhs",h,d[a].add,g.add.lhs),e._set(b,"rhs",h,d[a].add,g.add.rhs),e._set(b,"scalar","real",d[a].add,g.add.scalar),e.convert._set(b,d[a],f,"add")):g.and?(h=g.and._type,d[a]={},d[a].and={},e._set(b,"link1",h,d[a].and,g.and.link1),e._set(b,"link2",h,d[a].and,g.and.link2),e.convert._set(b,d[a],f,"and")):g.atan2?(h=g.atan2._type,d[a]={},d[a].atan2={},g.atan2._x&&(g.atan2.x=b.sifobj.sif.canvas.defs[g.atan2._x]),
g.atan2._y&&(g.atan2.y=b.sifobj.sif.canvas.defs[g.atan2._y]),e._set(b,"x","real",d[a].atan2,g.atan2.x),e._set(b,"y","real",d[a].atan2,g.atan2.y),e.convert._set(b,d[a],f,"atan2")):g.cos?(h=g.cos._type,d[a]={},d[a].cos={},g.cos._angle&&(g.cos.angle=b.sifobj.sif.canvas.defs[g.cos._angle]),g.cos._amp&&(g.cos.amp=b.sifobj.sif.canvas.defs[g.cos._amp]),e._set(b,"angle","angle",d[a].cos,g.cos.angle),e._set(b,"amp","real",d[a].cos,g.cos.amp),e.convert._set(b,d[a],f,"cos")):g.dotproduct?(h=g.dotproduct._type,
d[a]={},d[a].dotproduct={},g.dotproduct._lhs&&(g.dotproduct.lhs=b.sifobj.sif.canvas.defs[g.dotproduct._lhs]),g.dotproduct._rhs&&(g.dotproduct.rhs=b.sifobj.sif.canvas.defs[g.dotproduct._rhs]),e._set(b,"lhs","vector",d[a].dotproduct,g.dotproduct.lhs),e._set(b,"rhs","vector",d[a].dotproduct,g.dotproduct.rhs),e.convert._set(b,d[a],f,"dotproduct")):g.exp?(h=g.exp._type,d[a]={},d[a].exp={},g.exp._exp&&(g.exp.exp=b.sifobj.sif.canvas.defs[g.exp._exp]),g.exp._scale&&(g.exp.scale=b.sifobj.sif.canvas.defs[g.exp._scale]),
e._set(b,"exp","real",d[a].exp,g.exp.exp),e._set(b,"scale","real",d[a].exp,g.exp.scale),e.convert._set(b,d[a],f,"exp")):g.logarithm?(h=g.logarithm._type,d[a]={},d[a].logarithm={},g.logarithm._link&&(g.logarithm.link=b.sifobj.sif.canvas.defs[g.logarithm._link]),e._set(b,"link","real",d[a].logarithm,g.logarithm.link),e._set(b,"epsilon","real",d[a].logarithm,g.logarithm.epsilon),e._set(b,"infinite","real",d[a].logarithm,g.logarithm.infinite),e.convert._set(b,d[a],f,"logarithm")):g.reciprocal?(h=g.reciprocal._type,
d[a]={},d[a].reciprocal={},g.reciprocal._link&&(g.reciprocal.link=b.sifobj.sif.canvas.defs[g.reciprocal._link]),e._set(b,"link","real",d[a].reciprocal,g.reciprocal.link),e._set(b,"epsilon","real",d[a].reciprocal,g.reciprocal.epsilon),e._set(b,"infinite","real",d[a].reciprocal,g.reciprocal.infinite),e.convert._set(b,d[a],f,"reciprocal")):g.subtract?(h=g.subtract._type,d[a]={},d[a].subtract={},g.subtract._lhs&&(g.subtract.lhs=b.sifobj.sif.canvas.defs[g.subtract._lhs]),g.subtract._rhs&&(g.subtract.rhs=
b.sifobj.sif.canvas.defs[g.subtract._rhs]),g.subtract._scalar&&(g.subtract.scalar=b.sifobj.sif.canvas.defs[g.subtract._scalar]),e._set(b,"lhs",h,d[a].subtract,g.subtract.lhs),e._set(b,"rhs",h,d[a].subtract,g.subtract.rhs),e._set(b,"scalar","real",d[a].subtract,g.subtract.scalar),e.convert._set(b,d[a],f,"subtract")):g.sine?(h=g.sine._type,d[a]={},d[a].sine={},g.sine._angle&&(g.sine.angle=b.sifobj.sif.canvas.defs[g.sine._angle]),g.sine._amp&&(g.sine.amp=b.sifobj.sif.canvas.defs[g.sine._amp]),e._set(b,
"angle","angle",d[a].sine,g.sine.angle),e._set(b,"amp","real",d[a].sine,g.sine.amp),e.convert._set(b,d[a],f,"sine")):g.vectorangle?(h=g.vectorangle._type,d[a]={},d[a].vectorangle={},e._set(b,"vector","vector",d[a].vectorangle,g.vectorangle.vector),e.convert._set(b,d[a],f,"vectorangle")):g.greyed?e._set(b,a,f,d,g.greyed.link):(alert("no param type"),alert(JSON.stringify(g)+" layer type : "+b.type))};e._getNumber=function(b,a,f,d,g,h){var i,j;i={paused:!0,useTick:!0};var k=b.timeline,l,n=sifPlayer._secsToMillis;
d[a]={};if(g.animated){g=g.animated.waypoint;d[a].value=g[0][h]._value;i=createjs.Tween.get(d[a],i);"0s"!==g[0]._time&&(l=sifPlayer._getEase(g[0]._before),j=n(g[0]._time),i.to({value:g[0][h]._value},j,l));for(var m=0;m<g.length-1;m++)l=sifPlayer._getEase(g[m+1]._before),j=n(g[m+1]._time)-n(g[m]._time),i.to({value:g[m+1][h]._value},j,l);k.addTween(i)}else g[h]||alert(JSON.stringify(g)+"param_type : "+h+" param_name : "+a+" layer type : "+this.type),d[a].value=g[h]._value;e.convert._set(b,d[a],f,h)};
e._getTime=function(b,a,f,d,g){var h,i;h={paused:!0,useTick:!0};var j=b.timeline,k,l=sifPlayer._secsToMillis;d[a]={};if(g.animated){g=g.animated.waypoint;d[a].value=l(g[0].time._value);h=createjs.Tween.get(d[a],h);"0s"!==g[0]._time&&(k=sifPlayer._getEase(g[0]._before),i=l(g[0]._time),h.to({value:l(g[0].time._value)},i,k));for(var n=0;n<g.length-1;n++)k=sifPlayer._getEase(g[n+1]._before),i=l(g[n+1]._time)-l(g[n]._time),h.to({value:l(g[n+1].time._value)},i,k);j.addTween(h)}else g.time||alert(JSON.stringify(g)+
"param_type : time param_name : "+a+" layer type : "+this.type),d[a].value=l(g.time._value);e.convert._set(b,d[a],f,"integer")};e._getRadial_composite=function(b,a,f,d,g){param_type="radial_composite";d[a]={};d[a]._type=param_type;d[a].radial_composite={};g[param_type]._radius&&(g[param_type].radius=b.sifobj.sif.canvas.defs[g[param_type]._radius]);g[param_type]._theta&&(g[param_type].theta=b.sifobj.sif.canvas.defs[g[param_type]._theta]);e._set(b,"radius","real",d[a][param_type],g[param_type].radius);
e._set(b,"theta","angle",d[a][param_type],g[param_type].theta);e.convert._set(b,d[a],f,param_type)};e._getColor=function(b,a,f,d,g){f={paused:!0,useTick:!0};b=b.timeline;d[a]={};d[a].animated=!0;if(g.animated){w=g.animated.waypoint;d[a].r=w[0].color.r;d[a].g=w[0].color.g;d[a].b=w[0].color.b;d[a].a=w[0].color.a;tw=createjs.Tween.get(d[a],f);"0s"!==w[0]._time&&tw.to({r:w[0].color.r,g:w[0].color.g,b:w[0].color.b,a:w[0].color.a},sifPlayer._secsToMillis(w[0]._time),sifPlayer._getEase(w[0]._before));for(a=
0;a<w.length-1;a++)tw.to({r:w[a+1].color.r,g:w[a+1].color.g,b:w[a+1].color.b,a:w[a+1].color.a},sifPlayer._secsToMillis(w[a+1]._time)-sifPlayer._secsToMillis(w[a]._time),sifPlayer._getEase(w[a+1]._before));b.addTween(tw)}else d[a].r=g.color.r,d[a].g=g.color.g,d[a].b=g.color.b,d[a].a=g.color.a};e._getGradient=function(b,a,f,d,g,e){e="gradient";f={paused:!0,useTick:!0};b=b.timeline;d[a]={};var i;if(g.animated){w=g.animated.waypoint;d[e]={};d[e].color=[];for(var j=0,k=w[0].gradient.color.length;j<k;j++){d[e].color.push({});
i=d[e].color[j];a=w[0].gradient.color[j];i.pos=a._pos;i.r=a.r;i.g=a.g;i.b=a.b;i.a=a.a;tw=createjs.Tween.get(i,f);"0s"!==w[0]._time&&tw.to({pos:a._pos,r:a.r,g:a.g,b:a.b,a:a.a},sifPlayer._secsToMillis(w[0]._time),sifPlayer._getEase(w[0]._before));g=0;for(i=w.length-1;g<i;g++)a=w[g+1].gradient.color[j],tw.to({pos:a._pos,r:a.r,g:a.g,b:a.b,a:a.a},sifPlayer._secsToMillis(w[g+1]._time)-sifPlayer._secsToMillis(w[g]._time),sifPlayer._getEase(w[g+1]._before));b.addTween(tw)}}else{d[e]={};d[e].color=[];j=0;
for(k=g[e].color.length;j<k;j++)d[e].color.push({}),i=d[e].color[j],a=g[e].color[j],i.pos=a._pos,i.r=a.r,i.g=a.g,i.b=a.b,i.a=a.a}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){sifPlayer.param.vector={_get:function(e,b,a,f,d){var g,h;g={paused:!0,useTick:!0};var i=e.timeline;f[b]={};if(d.animated){d=d.animated.waypoint;f[b].x=d[0].vector.x;f[b].y=d[0].vector.y;g=createjs.Tween.get(f[b],g);"0s"!==d[0]._time&&(h=sifPlayer._secsToMillis(d[0]._time),g.to({x:d[0].vector.x,y:d[0].vector.y},h,sifPlayer._getEase(d[0]._before)));for(var j=0;j<d.length-1;j++)h=sifPlayer._secsToMillis(d[j+1]._time)-sifPlayer._secsToMillis(d[j]._time),g.to({x:d[j+1].vector.x,y:d[j+1].vector.y},
h,sifPlayer._getEase(d[j+1]._before));i.addTween(g);sifPlayer.param.convert._set(e,f[b],a,"vector")}else d.vector?(f[b].x=d.vector.x,f[b].y=d.vector.y,sifPlayer.param.convert._set(e,f[b],a,"vector",!1)):alert(JSON.stringify(d)+" in vector")},_setConvert:function(e,b,a,f){e=sifPlayer.param.vector;a===f?(b.getX=e.getX,b.getY=e.getY,b.setVector=e.setVector,b.setX=e.setX,b.setY=e.setY):"radial_composite"===f?(b.getX=e.getRadialX,b.getY=e.getRadialY):"composite"===f?(b.getX=e.getCompositeX,b.getY=e.getCompositeY):
"add"===f?(b.getX=e.getAddX,b.getY=e.getAddY):"scale"===f?b.scale.composite?(b.getX=e.getScaleCompositeX,b.getY=e.getScaleCompositeY):b.scale.radial_composite?(b.getX=e.getScaleRadialX,b.getY=e.getScaleRadialY):(b.getX=e.getScaleX,b.getY=e.getScaleY):"subtract"===f&&(b.getX=e.getSubX,b.getY=e.getSubY)},setVector:function(e,b){this.x=e;this.y=b},setX:function(e){this.x=e},setY:function(e){this.y=e},getX:function(){return this.x},getY:function(){return this.y},getScaleX:function(){return this.scale.link.getX()*
this.scale.scalar.getValue()},getScaleY:function(){return this.scale.link.getY()*this.scale.scalar.getValue()},getScaleCompositeX:function(){return this.scale.composite.x.getValue()*this.scalar.getValue()},getScaleCompositeY:function(){return this.scale.composite.y.getValue()*this.scalar.getValue()},getScaleRadialX:function(){var e=this.scale.radial_composite.theta.getValue()*Math.PI/180,b=this.scale.radial_composite.radius.getValue();return Math.cos(e)*b*this.scalar.getValue()},getScaleRadialY:function(){var e=
this.scale.radial_composite.theta.getValue()*Math.PI/180,b=this.scale.radial_composite.radius.getValue();return Math.sin(e)*b*this.scalar.getValue()},getRadialX:function(){var e=this.radial_composite.theta.getValue()*Math.PI/180,b=this.radial_composite.radius.getValue();return Math.cos(e)*b},getRadialY:function(){var e=this.radial_composite.theta.getValue()*Math.PI/180,b=this.radial_composite.radius.getValue();return Math.sin(e)*b},getCompositeX:function(){return this.composite.x.getValue()},getCompositeY:function(){return this.composite.y.getValue()},
getAddX:function(){return(this.add.lhs.getX()+this.add.rhs.getX())*this.add.scalar.getValue()},getAddY:function(){return(this.add.lhs.getY()+this.add.rhs.getY())*this.add.scalar.getValue()},getSubX:function(){return(this.subtract.lhs.getX()-this.subtract.rhs.getX())*this.subtract.scalar.getValue()},getSubY:function(){return(this.subtract.lhs.getY()-this.subtract.rhs.getY())*this.subtract.scalar.getValue()}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){sifPlayer.param.integer={_setConvert:function(e,b,a,f){e=sifPlayer.param.integer;a===f?(b.getValue=e.getValue,b.setValue=e.setValue):e[f]?b.getValue=e[f]:alert("no convert for integer to "+f)},setValue:function(e){this.value=e},getValue:function(){return this.value},add:function(){return(this.add.lhs.getValue()+this.add.rhs.getValue())*this.add.scalar.getValue()},subtract:function(){return(this.subtract.lhs.getValue()-this.subtract.rhs.getValue())*this.subtract.scalar.getValue()},scale:function(){return this.scale.link.getValue()*
this.scale.scalar.getValue()}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){var e={degsToRad:0.0174532925,_setConvert:function(b,a,f,d){b=sifPlayer.param.real;f===d?(a.getValue=b.getValue,a.setValue=b.setValue):b[d]?a.getValue=b[d]:alert("no convert for real to "+d)},setValue:function(b){this.value=b},getValue:function(){return this.value},add:function(){return(this.add.lhs.getValue()+this.add.rhs.getValue())*this.add.scalar.getValue()},subtract:function(){return(this.subtract.lhs.getValue()-this.subtract.rhs.getValue())*this.subtract.scalar.getValue()},scale:function(){return this.scale.link.getValue()*
this.scale.scalar.getValue()},cos:function(){return this.cos.amp.getValue()*Math.cos(this.cos.angle.getValue()*e.degsToRad)},sine:function(){return this.sine.amp.getValue()*Math.sin(this.sine.angle.getValue()*e.degsToRad)},dotproduct:function(){var b,a,f,d;b=this.dotproduct.lhs.getX();a=this.dotproduct.lhs.getY();f=this.dotproduct.rhs.getX();d=this.dotproduct.rhs.getY();return b*f+a*d},exp:function(){return Math.exp(this.exp.exp.getValue())*this.exp.scale.getValue()},logarithm:function(){var b=this.logarithm.link.getValue();
return b>=this.logarithm.epsilon.getValue()?Math.log(b):-this.logarithm.infinite.getValue()},reciprocal:function(){var b=this.reciprocal.link.getValue();return b>=this.reciprocal.epsilon.getValue()?1/b:-this.reciprocal.infinite.getValue()}};sifPlayer.param.real=e})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){sifPlayer.param.angle={_setConvert:function(e,b,a,f){e=sifPlayer.param.angle;a===f?(b.getValue=e.getValue,b.setValue=e.setValue):e[f]?b.getValue=e[f]:alert("no convert for angle to "+f)},setValue:function(e){this.value=e},getValue:function(){return this.value},add:function(){return(this.add.lhs.getValue()+this.add.rhs.getValue())*this.add.scalar.getValue()},subtract:function(){return(this.subtract.lhs.getValue()-this.subtract.rhs.getValue())*this.subtract.scalar.getValue()},scale:function(){return this.scale.link.getValue()*
this.scale.scalar.getValue()},atan2:function(){return 180*(Math.atan2(this.atan2.y.getValue(),this.atan2.x.getValue())/Math.PI)},dotproduct:function(){var e,b,a,f;e=this.dotproduct.lhs.getX();b=this.dotproduct.lhs.getY();a=this.dotproduct.rhs.getX();f=this.dotproduct.rhs.getY();return 180*(Math.acos((e*a+b*f)/(Math.sqrt(e*e+b*b)*Math.sqrt(a*a+f*f)))/Math.PI)},vectorangle:function(){return 180*(Math.atan2(this.vectorangle.vector.getY(),this.vectorangle.vector.getX())/Math.PI)}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){sifPlayer.param.bool={_get:function(e,b,a,f,d){var g=sifPlayer.param,h,i;h={paused:!0,useTick:!0};var j=e.sifobj.timeline,k,l=0,n=[0,1];f[b]={};if(d.animated){d=d.animated.waypoint;f[b].value=d[0].bool._value;h=createjs.Tween.get(f[b],h);"0s"!==d[0]._time&&(k=sifPlayer.Ease.bool,i=sifPlayer._secsToMillis(d[0]._time),h.to({value:d[0].bool._value},i,k));for(var m=0;m<d.length-1;m++)k=n[1-l]?sifPlayer.Ease.bool:sifPlayer.Ease.constant,l=1-l,i=sifPlayer._secsToMillis(d[m+1]._time)-sifPlayer._secsToMillis(d[m]._time),
d[m].bool._value!==d[m+1].bool._value?h.to({value:d[m+1].bool._value},i,k):h.wait(i);j.addTween(h)}else d.bool||alert(JSON.stringify(d)+"param_type : bool param_name : "+b+" layer type : "+this.type),f[b].value=d.bool._value;g.convert._set(e,f[b],a,"bool")},_setConvert:function(e,b,a,f){e=sifPlayer.param.bool;a===f?(b.getValue=e.getValue,b.setValue=e.setValue):"and"===f&&(b.getValue=e.getAnd)},setValue:function(e){this.value=e},getValue:function(){return this.value},getAnd:function(){return this.link1&&
this.link2}}})();this.sifPlayer.param=this.sifPlayer.param||{};
(function(){var e={_get:function(b,a,f,d,g){var e=sifPlayer.param,i=e._set,j="composite";d[a]={};d[a]._type=j;d[a].composite={};if("vector"===g.composite._type)g[j]._x&&(g[j].x=b.sifobj.sif.canvas.defs[g[j]._x]),g[j]._y&&(g[j].y=b.sifobj.sif.canvas.defs[g[j]._y]),i(b,"x","real",d[a].composite,g.composite.x),i(b,"y","real",d[a].composite,g.composite.y),e.convert._set(b,d[a],f,j);else if("bline_point"===g.composite._type){var k=d[a].composite,j=g.composite._type;g.composite._point&&(g.composite.point=
b.sifobj.sif.canvas.defs[g.composite._point]);i(b,"point","vector",k,g.composite.point);i(b,"width","real",k,g.composite.width);i(b,"origin","real",k,g.composite.origin);i(b,"split","bool",k,g.composite.split);i(b,"t1","vector",k,g.composite.t1);i(b,"t2","vector",k,g.composite.t2);e.convert._set(b,d[a].composite,f,j,g.composite.point.animated||g.composite.width.animated||g.composite.origin.animated||g.composite.t1.animated||g.composite.t2.animated)}},_setConvert:function(b,a,f,d){"bline_point"===
d?(a.getPoint=e.getPoint,a.getT1=e.bline_point_getT1,a.getT2=e.bline_point_getT2):alert("new type of point")},getPoint:function(){return this.point},bline_point_getPoint:function(){return this.point},bline_point_getT1:function(){return{x:this.t1.getX()/3,y:this.t1.getY()/3}},bline_point_getT2:function(){return{x:this.t2.getX()/3,y:this.t2.getY()/3}}};sifPlayer.param.composite=e})();this.sifPlayer.param=this.sifPlayer.param||{};this.sifPlayer.param.convert=this.sifPlayer.param.convert||{};(function(){sifPlayer.param.convert._set=function(e,b,a,f){"vector"===a?sifPlayer.param[a]._setConvert(e,b,a,f):"real"===a?sifPlayer.param[a]._setConvert(e,b,a,f):"integer"===a?sifPlayer.param[a]._setConvert(e,b,a,f):"angle"===a?sifPlayer.param[a]._setConvert(e,b,a,f):"bool"===a?sifPlayer.param[a]._setConvert(e,b,a,f):"composite"===a&&sifPlayer.param[a]._setConvert(e,b,a,f)}})();(function(){function e(){}var b=e.prototype;b.parent=null;b.sifobj=null;b.type=null;b.initLayer=function(a,f){e.setParent(this,a);this.type=f._type;f._desc&&(this.desc=f._desc,this.sifobj.desc[this.desc]=this);this.timeline=new createjs.Timeline;this.timeline.setPaused(!0);this.tracker=new sifPlayer.Tracker};e.setParent=function(a,f){f.hasOwnProperty("sifPath")?a.sifobj=f:(a.parent=f,a.sifobj=f.sifobj)};b.draw=function(){};b.setPosition=function(a){this.timeline.setPosition(a);return a};b._getBlend=
function(){switch(this.blend_method.getValue()){case 0:return"source-over";case 1:return"copy";case 13:return"source-atop";case 21:return"source-in";case 12:return"destination-over";case 19:return"destination-out";case 14:return"destination-in";default:return"source-over"}};sifPlayer.Layer=e})();(function(){function e(a,f){this.init(a,f)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,f){var d=sifPlayer.param._set;this.initLayer(a,f);d(this,"blend_method","integer",this,f.blend_method);d(this,"amount","real",this,f.amount);d(this,"origin","vector",this,f.origin);d(this,"color","color",this,f.color);this._getBline(f.bline)};b.draw=function(a){var f,d,g=a.ctx;g.fillStyle="rgba("+Math.round(256*this.color.r)+", "+Math.round(256*this.color.g)+", "+Math.round(256*this.color.b)+", "+this.color.a+
")";g.globalAlpha=this.amount.getValue();a.save();a.translate(this.origin.getX(),this.origin.getY());g.globalCompositeOperation=this._getBlend();g.beginPath();f=this.bline.entry[0].composite.getPoint();g.moveTo(f.getX(),f.getY());for(var b=0;b<this.bline.entry.length-1;b++)f=this.bline.entry[b].composite,d=this.bline.entry[b+1].composite,f.split.getValue()?this._bezierPart(g,f.getPoint(),d.getPoint(),f.getT2(),d.getT1()):this._bezierPart(g,f.getPoint(),d.getPoint(),f.getT1(),d.getT1());this.bline.loop&&
(f=this.bline.entry[this.bline.entry.length-1].composite,d=this.bline.entry[0].composite,f.split.getValue()?this._bezierPart(g,f.getPoint(),d.getPoint(),f.getT2(),d.getT1()):this._bezierPart(g,f.getPoint(),d.getPoint(),f.getT1(),d.getT1()));g.closePath();g.fill();a.restore()};b._getBline=function(a){var f=sifPlayer.param._set;this.bline={};this.bline.entry=[];this.bline.loop=a.bline._loop;for(var d=0,g=a.bline.entry.length;d<g;d++){var b={};f(this,"composite","composite",b,a.bline.entry[d]);this.bline.entry.push(b.composite)}};
b._bezierPart=function(a,f,d,b,e){var i;i=b.x+f.getX();f=b.y+f.getY();b=-e.x+d.getX();e=-e.y+d.getY();a.bezierCurveTo(i,f,b,e,d.getX(),d.getY())};sifPlayer.region=e})();(function(){function e(a,f){this.init(a,f)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,f){var d=sifPlayer.param._set;this.initLayer(a,f);d(this,"blend_method","integer",this,f.blend_method);d(this,"amount","real",this,f.amount);d(this,"width","real",this,f.width);d(this,"origin","vector",this,f.origin);d(this,"color","color",this,f.color);this._getBline(f.bline)};b.draw=function(a){var f=a.ctx,d,b;a.save();f.strokeStyle="rgba("+Math.round(256*this.color.r)+", "+Math.round(256*this.color.g)+
", "+Math.round(256*this.color.b)+", "+this.color.a+")";f.globalAlpha=this.amount.getValue();a.translate(this.origin.getX(),this.origin.getY());f.globalCompositeOperation=this._getBlend();f.beginPath();d=this.bline.entry[0].composite.getPoint();f.moveTo(d.getX(),d.getY());for(var e=0;e<this.bline.entry.length-1;e++)d=this.bline.entry[e].composite,b=this.bline.entry[e+1].composite,d.split.getValue()?this._bezierPart(f,d.getPoint(),b.getPoint(),d.getT2(),b.getT1()):this._bezierPart(f,d.getPoint(),b.getPoint(),
d.getT1(),b.getT1());this.bline.loop&&(d=this.bline.entry[this.bline.entry.length-1].composite,b=this.bline.entry[0].composite,d.split.getValue()?this._bezierPart(f,d.getPoint(),b.getPoint(),d.getT2(),b.getT1()):this._bezierPart(f,d.getPoint(),b.getPoint(),d.getT1(),b.getT1()));f.lineWidth=this.width.getValue();f.stroke();a.restore()};b._getBline=function(a){var f=sifPlayer.param._set;this.bline={};this.bline.entry=[];this.bline.loop=a.bline._loop;for(var d=0,b=a.bline.entry.length;d<b;d++){var e=
{};f(this,"composite","composite",e,a.bline.entry[d]);this.bline.entry.push(e.composite)}};b._bezierPart=function(a,f,d,b,e){var i;i=b.x+f.getX();f=b.y+f.getY();b=-e.x+d.getX();e=-e.y+d.getY();a.bezierCurveTo(i,f,b,e,d.getX(),d.getY())};sifPlayer.outline=e})();(function(){function e(a,f){this.init(a,f)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,f){var d=sifPlayer.param._set;this.initLayer(a,f);d(this,"amount","real",this,f.amount);d(this,"origin","vector",this,f.origin);d(this,"radius","real",this,f.radius);d(this,"blend_method","integer",this,f.blend_method);d(this,"color","color",this,f.color)};b.draw=function(a){var f=this.origin,a=a.ctx;a.fillStyle="rgba("+Math.round(256*this.color.r)+", "+Math.round(256*this.color.g)+", "+Math.round(256*
this.color.b)+", "+this.color.a+")";a.globalAlpha=this.amount.getValue();a.globalCompositeOperation=this._getBlend();a.beginPath();a.arc(f.getX(),f.getY(),this.radius.getValue(),0,2*Math.PI,!1);a.closePath();a.fill()};sifPlayer.circle=e})();(function(){function e(a,f){this.init(a,f)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,f){var d=sifPlayer.param._set;this.initLayer(a,f);d(this,"amount","real",this,f.amount);d(this,"blend_method","integer",this,f.blend_method);d(this,"tl","vector",this,f.tl);d(this,"br","vector",this,f.br);this.image=new Image;this.image.src=this.sifobj.sifPath+f.filename.string};b.draw=function(a){var f=a.ctx;a.save();f.globalAlpha=this.amount.getValue();f.globalCompositeOperation=this._getBlend();this._drawImage(f);
a.restore()};b._drawImage=function(a){var f=this.br.getX()-this.tl.getX(),d=this.tl.getY()-this.br.getY(),b,e;0>=f?(b=-1,f*=-1):b=1;0>=d?(e=1,d*=-1):e=-1;a.translate(this.tl.getX(),this.tl.getY());a.scale(b,e);a.drawImage(this.image,0,0,f,d)};sifPlayer.Import=e})();(function(){function e(a,f){this.init(a,f)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,f){var d=sifPlayer.param._set;this.initLayer(a,f);d(this,"amount","real",this,f.amount);d(this,"blend_method","integer",this,f.blend_method);d(this,"p1","vector",this,f.p1);d(this,"p2","vector",this,f.p2);d(this,"gradient","gradient",this,f.gradient)};b.draw=function(a){for(var a=a.ctx,f=a.createLinearGradient(this.p1.getX(),this.p1.getY(),this.p2.getX(),this.p2.getY()),d=this.gradient.color,b=0,e=d.length;b<
e;b++)f.addColorStop(d[b].pos,"rgba("+Math.round(256*d[b].r)+", "+Math.round(256*d[b].g)+", "+Math.round(256*d[b].b)+", "+d[b].a+")");a.globalAlpha=this.amount.getValue();a.globalCompositeOperation=this._getBlend();a.fillStyle=f;a.fillRect(-1E3,-1E3,2E3,2E3)};sifPlayer.linear_gradient=e})();(function(){function e(a,f){this.init(a,f)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,f){var b=sifPlayer.param._set;this.initLayer(a,f);b(this,"amount","real",this,f.amount);b(this,"blend_method","integer",this,f.blend_method);b(this,"origin","vector",this,f.origin);b(this,"zoom","real",this,f.zoom);b(this,"focus","vector",this,f.focus);this._getLayers(f.canvas.canvas.layer);this.dCanvas=document.createElement("canvas");this.tracker=new sifPlayer.Tracker(this.dCanvas.getContext("2d"))};
b._getLayers=function(a){this.layer=[];if(a)for(var f=0;f<a.length;f++)this.layer.push(sifPlayer._getLayer(this,a[f]))};b.draw=function(a){var f=Math.exp(this.zoom.getValue()),b=this.layer,e=this.focus,h=this.origin;this.dCanvas.height=0;this.dCanvas.height=this.sifobj.height;this.dCanvas.width=this.sifobj.width;this.tracker.setMatrix(a.matrix);this.tracker.translate(e.getX(),e.getY());this.tracker.scale(f,f);this.tracker.translate(-e.getX(),-e.getY());this.tracker.translate(h.getX()/f,h.getY()/f);
f=0;for(e=b.length;f<e;f++)b[f].draw(this.tracker);a.ctx&&(a.save(),a.setMatrix([1,0,0,1,0,0]),a.ctx.globalAlpha=this.amount.getValue(),a.ctx.globalCompositeOperation=this._getBlend(),a.ctx.drawImage(this.tracker.ctx.canvas,0,0),a.restore())};b.setPosition=function(a){var f=this.layer;this.timeline.setPosition(a);for(var b=0,e=f.length;b<e;b++)a=f[b].setPosition(a);return a};e.makeFake=function(a){var f={_type:"PasteCanvas",_active:!0,_version:0.1,z_depth:{_name:"z_depth",real:{_value:0}},amount:{_name:"amount",
real:{_value:1}},blend_method:{_name:"blend_method",integer:{_value:0}},origin:{_name:"origin",vector:{x:0,y:0}},canvas:{_name:"canvas",canvas:{}},zoom:{_name:"zoom",real:{_value:0}},time_offset:{_name:"time_offset",time:{_value:"0s"}},children_lock:{_name:"children_lock",bool:{_value:!1,_static:!0}},focus:{_name:"focus",vector:{x:0,y:0}},outline_grow:{_name:"outline_grow",real:{_value:0}}};return new sifPlayer[f._type](a,f)};sifPlayer.PasteCanvas=e})();(function(){function e(a,f){this.init(a,f)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,f){var b=sifPlayer.param._set;this.initLayer(a,f);b(this,"amount","real",this,f.amount);b(this,"blend_method","integer",this,f.blend_method);b(this,"center","vector",this,f.center);b(this,"radius","real",this,f.radius);b(this,"gradient","gradient",this,f.gradient)};b.draw=function(a){for(var a=a.ctx,b=this.center.getX(),d=this.center.getY(),b=a.createRadialGradient(b,d,0,b,d,this.radius.getValue()),
d=this.gradient.color,e=0,h=d.length;e<h;e++)b.addColorStop(d[e].pos,"rgba("+Math.round(256*d[e].r)+", "+Math.round(256*d[e].g)+", "+Math.round(256*d[e].b)+", "+d[e].a+")");a.globalAlpha=this.amount.getValue();a.globalCompositeOperation=this._getBlend();a.fillStyle=b;a.fillRect(-1E3,-1E3,2E3,2E3)};sifPlayer.radial_gradient=e})();(function(){function e(a,b){this.init(a,b)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,b){this.initLayer(a,b)};b.draw=function(a){a.restore()};sifPlayer.restore=e})();(function(){function e(a,b){this.init(a,b)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"origin","vector",this,b.origin);d(this,"amount","angle",this,b.amount)};b.draw=function(a){a.save();a.translate(this.origin.getX(),this.origin.getY());a.rotate(this.amount.getValue()*Math.PI/180);a.translate(-this.origin.getX(),-this.origin.getY())};sifPlayer.rotate=e})();(function(){function e(a,b){this.init(a,b)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"amount","vector",this,b.amount);d(this,"center","vector",this,b.center)};b.draw=function(a){var b=this.center,d=this.amount;a.save();a.translate(b.getX(),b.getY());a.scale(d.getX(),d.getY());a.translate(-b.getX(),-b.getY())};sifPlayer.stretch=e})();(function(){function e(a,b){this.init(a,b)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"origin","vector",this,b.origin)};b.draw=function(a){var b=this.origin;a.save();a.translate(b.getX(),b.getY())};sifPlayer.translate=e})();(function(){function e(a,b){this.init(a,b)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"center","vector",this,b.center);d(this,"amount","real",this,b.amount)};b.draw=function(a){var b=Math.exp(this.amount.getValue()),d=this.center;a.save();a.translate(d.getX(),d.getY());a.scale(b,b);a.translate(-d.getX()/b,-d.getY()/b)};sifPlayer.zoom=e})();(function(){function e(a,b){this.init(a,b)}var b=e.prototype=new sifPlayer.Layer;b.init=function(a,b){var d=sifPlayer.param._set;this.initLayer(a,b);d(this,"link_time","integer",this,b.link_time);d(this,"local_time","integer",this,b.local_time);d(this,"duration","integer",this,b.duration);this.timeline.duration=this.sifobj.sif.canvas.end_time-this.sifobj.sif.canvas.begin_time;this.timeline.loop=!0};b.setPosition=function(a){this.timeline.tick(a-this.timeline.position);var b=this.duration.getValue(),
d=this.link_time.getValue(),e=this.local_time.getValue(),a=(a+e)%b;return 0!=b?0<b?a+d:d-a:d};sifPlayer.timeloop=e})();(function(){sifPlayer.helper={loadXML:function(e){var b=new XMLHttpRequest;b.open("GET",e,!1);b.send();return b.responseXML},StringtoXML:function(e){return(new DOMParser).parseFromString(e,"text/xml")},setCanvasToWindowSize:function(e,b,a){b/=a;a=window.innerWidth/window.innerHeight;1<=b?b>=a?(e.width=window.innerWidth,e.height=e.width/b):(e.height=window.innerHeight,e.width=window.innerHeight*b):b<=a?(e.height=window.innerHeight,e.width=e.height*b):(e.width=window.innerWidth,e.height=e.width/b)}}})();
